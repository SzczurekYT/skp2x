let listOfCustomers={id:"listOfCustomers",view:"datatable",select:!0,ikonaKosza:"<span class='webix_icon fa-trash customers-kosz'></span>",css:"list-of-customers",columns:[{id:"index",header:"Lp.",sort:"int",width:35,css:{"text-align":"right"}},{id:"WebixCustomer_kosz",header:{css:"trashHeader",text:"<span id='trashHeaderSpan' class='webix_icon fa-trash'></span>"},width:40,css:{"text-align":"center"}},{id:"WebixCustomer_name",header:[{content:"serverFilter"}],fillspace:!0},{id:"WebixAdresSiedziby_miasto",header:"Miasto",adjust:!0},{id:"WebixCustomer_ulica_nr",header:"Ulica, numer",adjust:!0},{id:"WebixCustomerRealOwner_name",header:[{content:"serverSelectFilter",options:globalAppData.customerOwners}],width:108}],onClick:{trashHeader:function(){listOfCustomers.postData.kosz=!listOfCustomers.postData.kosz,listOfCustomers.adjustKosz(),$$(listOfCustomers.id).filterByAll()}},adjustKosz:function(){let e=document.getElementById("trashHeaderSpan");listOfCustomers.postData.kosz?e.classList.add("customers-kosz"):e.classList.remove("customers-kosz")},meant2hide:["WebixAdresSiedziby_miasto","WebixCustomer_ulica_nr"],hideTheColumns:function(){this.meant2hide.forEach(function(e){$$(listOfCustomers.id).hideColumn(e)})},showTheColumns:function(){this.meant2hide.forEach(function(e){$$(listOfCustomers.id).showColumn(e)})},scheme:{$init:function(e){e.index=this.count()}},postData:{fraza:"",realOwnerId:globalAppData.loggedInUser.id,limit:globalAppData.config.customersHowMany,kosz:!1},url:function(){let e=globalAppData.config.customersGetMany;return globalAppData.loggedInUser.id==listOfCustomers.postData.realOwnerId&&loggedUserInHasNoAnyCustomer()&&(listOfCustomers.postData.realOwnerId=0),webix.ajax().post(e,listOfCustomers.postData).then(function(e){if(e.text().search("records")>=0){console.log("Here!");let i=e.json();return i.records.forEach(function(e){e.WebixCustomer_ulica_nr=`${e.WebixAdresSiedziby_ulica} ${e.WebixAdresSiedziby_nr_budynku}`,0==e.WebixCustomer_howManyNonPrivateOrders&&(e.WebixCustomer_kosz=listOfCustomers.ikonaKosza)}),i.records}console.log("There!"),window.open("/pulpit","_self")})},parseChain:function(e){let i;for(i=0;i<globalAppData.config.maxUpLinks;i++)e["link"+i]="";if("WebixChain"in e&&e.WebixChain.length)for(i=0;i<e.WebixChain.length;i++)e["link"+i]=e.WebixChain[i].chain+"-"+e.WebixCustomerRealOwner_inic.toLowerCase()+e.WebixCustomer_id},on:{onAfterFilter:function(){$$(customerPanel.id).isVisible()&&($$(customerPanel.id).hide(),$$(listOfCustomers.id).config.showTheColumns()),this.getFilter("WebixCustomer_name").focus(),listOfCustomers.adjustKosz()},onBeforeFilter:function(){listOfCustomers.postData.realOwnerId=this.getFilter("WebixCustomerRealOwner_name").value,listOfCustomers.postData.fraza=this.getFilter("WebixCustomer_name").value},onAfterLoad:function(){$$(manageCustomers.id).isVisible()&&this.getFilter("WebixCustomerRealOwner_name").value!=listOfCustomers.postData.realOwnerId&&(this.getFilter("WebixCustomerRealOwner_name").value=listOfCustomers.postData.realOwnerId),this.getFilter("WebixCustomer_name").focus()},onAfterSelect:function(e){let i=$$(listOfCustomers.id).getItem(e).WebixCustomer_id,t=globalAppData.config.justOneCustomerData+i+".json";webix.ajax(t).then(function(e){let i=e.json();$$(listOfCustomers.id).config.parseChain(i),$$(customerPanel.id).isVisible()||($$(listOfCustomers.id).config.hideTheColumns(),$$(customerPanel.id).show(),listOfCustomers.adjustKosz()),0==i.WebixCustomer_howManyNonPrivateOrders?($$("cd_delete").config.badge=""+i.WebixCustomer_howManyPrivateOrders,$$("cd_delete").refresh(),$$("cd_delete").show()):$$("cd_delete").hide(),i.WebixCustomer_comment.length&&(i.WebixCustomer_comment=`<div class="cdetails-comment">${i.WebixCustomer_comment}</div>"`),$$(customerDetail.id).parse(i)})}}};function generujDropWidget(){return webix.ui({id:"dropoza",container:"link-producer",width:140,cols:[{id:"gen-link",view:"button",value:"Generuj link",css:"gen-button",click:function(){webix.message("Generujemy linki"),$$("gen-link").hide(),$$("link-spin").show(),setTimeout(function(){$$("link-spin").hide(),$$("gen-link").show()},2e3)}},{id:"link-spin",view:"icon",icon:"fas fa-spinner fa-spin",hidden:!0}]})}function loggedUserInHasNoAnyCustomer(){let e;for(e=0;e<globalAppData.customerOwners.length;e++)if(globalAppData.customerOwners[e].id==globalAppData.loggedInUser.id)return!1;return!0}let customerName={template:globalAppData.template.theCustomerDetail1,height:60},addOrderAllTheRest_={id:"addOrderAllTheRest_",template:" ",borderless:!0},theInputWidth=380,formularz={id:"formularz",view:"form",elements:[{view:"select",name:"newcustomer",options:[{id:"",value:"- wybierz-"},{id:"0",value:"STAŁY"},{id:"1",value:"NOWY"}],width:100},{view:"text",name:"email",placeholder:"e-mail",width:theInputWidth,align:"left",label:"Link do przesyłania plików zostanie wysłany na adres:",labelAlign:"left",labelPosition:"top"},{view:"text",name:"nazwa_karty",placeholder:"Nazwa karty",width:theInputWidth,align:"left"},{view:"text",name:"ile",placeholder:"Ilość",width:150,align:"left",attributes:{type:"number",min:"1"}},{view:"textarea",width:theInputWidth,height:150,name:"uwagi",placeholder:"Uwagi"},{id:"submitButton",label:"Zapisz!",view:"button",width:120,name:"zapisz",hidden:!0},{}]};webix.ready(function(){});let addOrderAllTheRest={id:"addOrderAllTheRest",cols:[formularz,{template:" ",borderless:!0}],hidden:!0,borderless:!0,css:"add-inside"},addOrderNaglowek={id:"addOrderNaglowek",type:"header",template:"<span>Nowe zamówienie</span>",hidden:!0},addNewQuickOrder={id:"addNewQuickOrder",css:"add-quick-order moj-naglowek",hidden:!0,rows:[addOrderNaglowek,{id:"customerName",template:" ",borderless:!0,css:"add-inside klient-nazwa"},addOrderAllTheRest,addOrderAllTheRest_]},customerDetail={id:"customerDetail",css:"customer-detail",template:globalAppData.template.theCustomerDetail3,scroll:!0},buttDl=90,customerDetailToolbar={id:"customerDetailToolbar",view:"toolbar",gravity:.19,css:"customer-detail-toolbar",elements:[{id:"more",view:"button",type:"icon",icon:"info-circle",css:"cd-button",click:"sTCB",width:buttDl},{},{id:"cd_delete",view:"button",css:"cd-kosz cd-button",type:"icon",icon:"trash-o",badge:0,click:"sTCB",width:buttDl},{},{id:"closeIt",view:"button",css:"cd-button",type:"icon",icon:"times",click:"sTCB",width:buttDl}],obsluzKlikniecieBatona:function(e){let i=$$(listOfCustomers.id).getSelectedItem().WebixCustomer_id;switch(e){case"closeIt":$$(customerPanel.id).isVisible()&&($$(customerPanel.id).hide(),$$(listOfCustomers.id).config.showTheColumns(),$$(listOfCustomers.id).clearSelection());break;case"more":window.open(globalAppData.config.customerUrl+i,"_blank");break;case"cd_delete":webix.confirm({title:"POTWIERDŹ USUNIĘCIE",text:"Klient oraz powiązane z nim dane - zamówienia, karty zostaną USUNIĘTE! Kontynuowć?",ok:"Tak",cancel:"NIE",callback:function(e){if(e){let e=globalAppData.config.delCustomerUrl+i+".json";webix.ajax(e,function(e,i){$dl=e.search("err"),$dl>=0?(console.log(i.json()),i.json().err||$$(listOfCustomers.id).filterByAll()):window.open("/pulpit","_self")})}}});break;default:webix.message(e)}}};function sTCB(e){$$(customerDetailToolbar.id).config.obsluzKlikniecieBatona(e)}let customerPanel={id:"customerPanel",animate:{subtype:"in"},gravity:.8,hidden:!0,css:"customer-panel",cells:[{rows:[customerDetailToolbar,customerDetail]},addNewQuickOrder]},conf={thePeopleFilterHeader:{content:"serverSelectFilter",options:[]},theUserId:globalAppData.loggedInUser.id},kolumny=[{id:"index",header:"",sort:"int",adjust:!0},{id:"WebixPrivateOrder_id",header:"id",adjust:!0},{id:"WebixCustomer_name",header:"Klient",fillspace:!0},{id:"WebixPrivateOrder_ileKart",header:"<span class='webix_icon fa-credit-card'></span>",adjust:!0},{id:"WebixPrivateOrderOwner_name",header:[conf.thePeopleFilterHeader],width:108},{id:"WebixPrivateOrder_stop_day",header:"Termin",adjust:!0}],onBeforeFilterHandler=function(){conf.theUserId=this.getFilter("WebixPrivateOrderOwner_name").value},onAfterLoadHandler=function(){$$(managePrivateOrders.id).isVisible()&&(this.getFilter("WebixPrivateOrderOwner_name").value!=conf.theUserId&&(this.getFilter("WebixPrivateOrderOwner_name").value=conf.theUserId),$$(listOfCards.id).clearAll(!0),$$(listOfCards.id).hide(),$$(theOrderDetail.id).define("template",""),$$(theOrderDetail.id).refresh())},onAfterSelectHandler=function(e){$$(listOfCards.id).show(),$$(listOfCards.id).clearAll(!0);let i="webixOrders/getOneOrderLight/"+$$(listOfPrivateOrders.id).getItem(e).WebixPrivateOrder_id+".json";webix.ajax(i).then(function(e){let i=e.json();i.WebixOrder_ileKart&&$$(listOfCards.id).parse(i.WebixCard),$$(theOrderDetail.id).define("template",globalAppData.template.theOrderDetail),$$(theOrderDetail.id).parse({id:i.WebixOrder_id,termin:i.WebixOrder_stop_day})})},listOfCards={id:"listOfCards",view:"datatable",hidden:!0,columns:[{id:"index",header:"",sort:"int",width:35},{id:"id",header:"id",width:60},{id:"name",header:"Nazwa karty",fillspace:!0}],scheme:{$init:function(e){e.index=this.count()}}},theOrderDetail={id:"theOrderDetail",view:"template",css:"theOrderDetail",gravity:1},privateOrdersUrlHandler=function(){let e="webixPrivateOrders/getTheOrders/"+conf.theUserId+".json";return webix.ajax(e).then(function(e){if(e.text().search("records")>=0){let i=e.json();return conf.thePeopleFilterHeader.options=i.peopleHavingPrivs,i.records}return[]})},listOfPrivateOrders={id:"listOfPrivateOrders",view:"datatable",select:!0,gravity:1.7,columns:kolumny,scheme:{$init:function(e){e.index=this.count()}},url:privateOrdersUrlHandler,on:{onBeforeFilter:onBeforeFilterHandler,onAfterLoad:onAfterLoadHandler,onAfterSelect:onAfterSelectHandler}},managePrivateOrders={id:"managePrivateOrders",padding:globalAppData.config.wyglad.mainPad,type:"space",css:"moj-naglowek",cols:[listOfPrivateOrders,{gravity:.01},{rows:[theOrderDetail,listOfCards]}]},manageCustomers={id:"manageCustomers",padding:globalAppData.config.wyglad.mainPad,type:"space",cols:[listOfCustomers,customerPanel]},toolbarMenu={id:"toolbarMenu",view:"menu",data:[{id:"klienci",value:"Klienci",icon:"address-book-o",whereToGo:manageCustomers.id},{id:"prywatne",value:"Prywatne",icon:"handshake-o",whereToGo:"managePrivateOrders"}],css:"toolbar-menu",ready:function(){$$(toolbarMenu.id).disableItem("klienci")},on:{onMenuItemClick:function(e){$$(this.getMenuItem(e).whereToGo).show(),$$(toolbarMenu.id).config.data.forEach(function(e){$$(toolbarMenu.id).enableItem(e.id)}),$$(toolbarMenu.id).disableItem(e)}}},userInfo={view:"button",type:"icon",icon:"user",label:globalAppData.loggedInUser.name,width:110,id:"userInfoToolbar",css:"kwa-mia-hau",click:function(){window.open(globalAppData.config.logoutUrl,"_self")}},mainToolbar={responsive:!0,view:"toolbar",padding:3,elements:[{view:"label",label:" ",width:68},{},userInfo]},menu_data=[{id:"side-klienci",icon:"address-book-o",value:"Klienci",data:[{id:"side-klienci-list",value:'<i class="fa fa-list" aria-hidden="true"></i> Lista'},{id:"side-klienci-add",value:'<i class="fa fa-plus" aria-hidden="true"></i> Dodaj'}]},{id:"side-karty",icon:"credit-card",value:"Karty",data:[{id:"side-karty-list",value:'<i class="fa fa-list" aria-hidden="true"></i> Lista'},{id:"side-karty-add",value:'<i class="fa fa-plus" aria-hidden="true"></i> Dodaj'}]},{id:"side-handlowe",icon:"handshake-o",value:"Handlowe",data:[{id:"side-handlowe-list",value:'<i class="fa fa-list" aria-hidden="true"></i> Lista'},{id:"side-handlowe-add",value:'<i class="fa fa-plus" aria-hidden="true"></i> Dodaj'}]},{id:"side-produkcyjne",icon:"industry",value:"Produkcyjne",data:[{id:"side-produkcyjne-list",value:'<i class="fa fa-list" aria-hidden="true"></i> Lista'},{id:"side-produkcyjne-add",value:'<i class="fa fa-plus" aria-hidden="true"></i> Dodaj'}]}],leftSidebar={view:"sidebar",id:"lewy-sidebar",data:menu_data,collapsed:!0,on:{onAfterSelect:function(e){let i,t=!0;switch(e){case"side-klienci-list":i="customers";break;case"side-klienci-add":i="customers/add";break;case"side-karty-list":i="cards";break;case"side-karty-add":i="cards/add";break;case"side-handlowe-list":i="orders";break;case"side-handlowe-add":i="orders/add";break;case"side-produkcyjne-list":i="jobs";break;case"side-produkcyjne-add":i="jobs/add";break;default:t=!1}t&&window.open(i,"_self")}}},animacja={a:{direction:"top"},b:{type:"flip"},c:{type:"flip",subtype:"vertical"},d:{subtype:"out"},e:{subtype:"in"},f:!1},content={id:"content",animate:animacja.d,cells:[manageCustomers,managePrivateOrders]};webix.ready(function(){let e={id:"theLayout",css:"app-main",rows:[mainToolbar,{cols:[leftSidebar,content]}]};webix.ui(e)});