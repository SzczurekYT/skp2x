let listOfCustomers={id:"listOfCustomers",view:"datatable",select:!0,ikonaKosza:"<span class='webix_icon fa-trash customers-kosz'></span>",css:"list-of-customers",columns:[{id:"index",header:"Lp.",sort:"int",width:35,css:{"text-align":"right"}},{id:"WebixCustomer_kosz",header:{css:"trashHeader",text:"<span id='trashHeaderSpan' class='webix_icon fa-trash'></span>"},width:40,css:{"text-align":"center"}},{id:"WebixCustomer_name",header:[{content:"serverFilter"}],fillspace:!0},{id:"WebixAdresSiedziby_miasto",header:"Miasto",adjust:!0},{id:"WebixCustomer_ulica_nr",header:"Ulica, numer",adjust:!0},{id:"WebixCustomerRealOwner_name",header:[{content:"serverSelectFilter",options:globalAppData.customerOwners}],width:108}],onClick:{trashHeader:function(){listOfCustomers.postData.kosz=!listOfCustomers.postData.kosz,listOfCustomers.adjustKosz(),$$(listOfCustomers.id).filterByAll()}},adjustKosz:function(){let a=document.getElementById("trashHeaderSpan");listOfCustomers.postData.kosz?a.classList.add("customers-kosz"):a.classList.remove("customers-kosz")},meant2hide:["WebixAdresSiedziby_miasto","WebixCustomer_ulica_nr"],hideTheColumns:function(){this.meant2hide.forEach(function(a){$$(listOfCustomers.id).hideColumn(a)})},showTheColumns:function(){this.meant2hide.forEach(function(a){$$(listOfCustomers.id).showColumn(a)})},scheme:{$init:function(a){a.index=this.count()}},postData:{fraza:"",realOwnerId:globalAppData.loggedInUser.id,limit:globalAppData.config.customersHowMany,kosz:!1},url:function(){let a=globalAppData.config.customersGetMany;globalAppData.loggedInUser.id==listOfCustomers.postData.realOwnerId&&loggedUserInHasNoAnyCustomer()&&(listOfCustomers.postData.realOwnerId=0);let b=webix.ajax().post(a,listOfCustomers.postData);return b.then(function(a){if(0<=a.text().search("records")){console.log("Here!");let b=a.json();return b.records.forEach(function(a){a.WebixCustomer_ulica_nr=`${a.WebixAdresSiedziby_ulica} ${a.WebixAdresSiedziby_nr_budynku}`,0==a.WebixCustomer_howManyNonPrivateOrders&&(a.WebixCustomer_kosz=listOfCustomers.ikonaKosza)}),b.records}console.log("There!"),window.open("/pulpit","_self")})},parseChain:function(a){let b;for(b=0;b<globalAppData.config.maxUpLinks;b++)a["link"+b]="";if("WebixChain"in a&&a.WebixChain.length)for(b=0;b<a.WebixChain.length;b++)a["link"+b]=a.WebixChain[b].chain+a.WebixCustomer_id},on:{onAfterFilter:function(){$$(customerPanel.id).isVisible()&&($$(customerPanel.id).hide(),$$(listOfCustomers.id).config.showTheColumns()),this.getFilter("WebixCustomer_name").focus(),listOfCustomers.adjustKosz()},onBeforeFilter:function(){listOfCustomers.postData.realOwnerId=this.getFilter("WebixCustomerRealOwner_name").value,listOfCustomers.postData.fraza=this.getFilter("WebixCustomer_name").value},onAfterLoad:function(){$$(manageCustomers.id).isVisible()&&this.getFilter("WebixCustomerRealOwner_name").value!=listOfCustomers.postData.realOwnerId&&(this.getFilter("WebixCustomerRealOwner_name").value=listOfCustomers.postData.realOwnerId),this.getFilter("WebixCustomer_name").focus()},onAfterSelect:function(a){let b=$$(listOfCustomers.id).getItem(a).WebixCustomer_id,c=globalAppData.config.justOneCustomerData+b+".json";webix.ajax(c).then(function(a){let b=a.json();$$(listOfCustomers.id).config.parseChain(b),$$(customerPanel.id).isVisible()||($$(listOfCustomers.id).config.hideTheColumns(),$$(customerPanel.id).show(),listOfCustomers.adjustKosz()),0==b.WebixCustomer_howManyNonPrivateOrders?($$("cd_delete").config.badge=""+b.WebixCustomer_howManyPrivateOrders,$$("cd_delete").refresh(),$$("cd_delete").show()):$$("cd_delete").hide(),b.WebixCustomer_comment.length&&(b.WebixCustomer_comment=`<div class="cdetails-comment">${b.WebixCustomer_comment}</div>"`),$$(customerDetail.id).parse(b)})}}};function loggedUserInHasNoAnyCustomer(){let a;for(a=0;a<globalAppData.customerOwners.length;a++)if(globalAppData.customerOwners[a].id==globalAppData.loggedInUser.id)return!1;return!0}let customerName={template:globalAppData.template.theCustomerDetail1,height:60},addOrderAllTheRest_={id:"addOrderAllTheRest_",template:" ",borderless:!0},theInputWidth=380,formularz={id:"formularz",view:"form",elements:[{view:"select",name:"newcustomer",options:[{id:"",value:"- wybierz-"},{id:"0",value:"STA\u0141Y"},{id:"1",value:"NOWY"}],width:100},{view:"text",name:"email",placeholder:"e-mail",width:theInputWidth,align:"left",label:"Link do przesy\u0142ania plik\xF3w zostanie wys\u0142any na adres:",labelAlign:"left",labelPosition:"top"},{view:"text",name:"nazwa_karty",placeholder:"Nazwa karty",width:theInputWidth,align:"left"},{view:"text",name:"ile",placeholder:"Ilo\u015B\u0107",width:150,align:"left",attributes:{type:"number",min:"1"}},{view:"textarea",width:theInputWidth,height:150,name:"uwagi",placeholder:"Uwagi"},{id:"submitButton",label:"Zapisz!",view:"button",width:120,name:"zapisz",hidden:!0},{}]};webix.ready(function(){});let addOrderAllTheRest={id:"addOrderAllTheRest",cols:[formularz,{template:" ",borderless:!0}],hidden:!0,borderless:!0,css:"add-inside"},addOrderNaglowek={id:"addOrderNaglowek",type:"header",template:"<span>Nowe zam\xF3wienie</span>",hidden:!0},addNewQuickOrder={id:"addNewQuickOrder",css:"add-quick-order moj-naglowek",hidden:!0,rows:[addOrderNaglowek,{id:"customerName",template:" ",borderless:!0,css:"add-inside klient-nazwa"},addOrderAllTheRest,addOrderAllTheRest_]};let customerDetail={id:"customerDetail",css:"customer-detail",template:globalAppData.template.theCustomerDetail3,scroll:!0},buttDl=90,customerDetailToolbar={id:"customerDetailToolbar",view:"toolbar",gravity:.19,css:"customer-detail-toolbar",elements:[{id:"more",view:"button",type:"icon",icon:"info-circle",css:"cd-button",click:"sTCB",width:buttDl},{},{id:"cd_delete",view:"button",css:"cd-kosz cd-button",type:"icon",icon:"trash-o",badge:0,click:"sTCB",width:buttDl},{},{id:"closeIt",view:"button",css:"cd-button",type:"icon",icon:"times",click:"sTCB",width:buttDl}],obsluzKlikniecieBatona:function(a){let b=$$(listOfCustomers.id).getSelectedItem().WebixCustomer_id;"closeIt"===a?$$(customerPanel.id).isVisible()&&($$(customerPanel.id).hide(),$$(listOfCustomers.id).config.showTheColumns(),$$(listOfCustomers.id).clearSelection()):"more"===a?window.open(globalAppData.config.customerUrl+b,"_blank"):"cd_delete"===a?webix.confirm({title:"POTWIERD\u0179 USUNI\u0118CIE",text:"Klient oraz powi\u0105zane z nim dane - zam\xF3wienia, karty zostan\u0105 USUNI\u0118TE! Kontynuow\u0107?",ok:"Tak",cancel:"NIE",callback:function(a){if(a){let a=globalAppData.config.delCustomerUrl+b+".json";webix.ajax(a,function(a,b){$dl=a.search("err"),0<=$dl?(console.log(b.json()),!b.json().err&&$$(listOfCustomers.id).filterByAll()):window.open("/pulpit","_self")})}}}):webix.message(a)}};function sTCB(a){$$(customerDetailToolbar.id).config.obsluzKlikniecieBatona(a)}let customerPanel={id:"customerPanel",animate:{subtype:"in"},gravity:.8,hidden:!0,css:"customer-panel",cells:[{rows:[customerDetailToolbar,customerDetail]},addNewQuickOrder]},conf={thePeopleFilterHeader:{content:"serverSelectFilter",options:[]},theUserId:globalAppData.loggedInUser.id},kolumny=[{id:"index",header:"",sort:"int",adjust:!0},{id:"WebixPrivateOrder_id",header:"id",adjust:!0},{id:"WebixCustomer_name",header:"Klient",fillspace:!0},{id:"WebixPrivateOrder_ileKart",header:"<span class='webix_icon fa-credit-card'></span>",adjust:!0},{id:"WebixPrivateOrderOwner_name",header:[conf.thePeopleFilterHeader],width:108},{id:"WebixPrivateOrder_stop_day",header:"Termin",adjust:!0}];let onBeforeFilterHandler=function(){conf.theUserId=this.getFilter("WebixPrivateOrderOwner_name").value},onAfterLoadHandler=function(){$$(managePrivateOrders.id).isVisible()&&(this.getFilter("WebixPrivateOrderOwner_name").value!=conf.theUserId&&(this.getFilter("WebixPrivateOrderOwner_name").value=conf.theUserId),$$(listOfCards.id).clearAll(!0),$$(listOfCards.id).hide(),$$(theOrderDetail.id).define("template",""),$$(theOrderDetail.id).refresh())},onAfterSelectHandler=function(a){$$(listOfCards.id).show(),$$(listOfCards.id).clearAll(!0);let b="webixOrders/getOneOrderLight/"+$$(listOfPrivateOrders.id).getItem(a).WebixPrivateOrder_id+".json";webix.ajax(b).then(function(a){let b=a.json();b.WebixOrder_ileKart&&$$(listOfCards.id).parse(b.WebixCard),$$(theOrderDetail.id).define("template",globalAppData.template.theOrderDetail),$$(theOrderDetail.id).parse({id:b.WebixOrder_id,termin:b.WebixOrder_stop_day})})},listOfCards={id:"listOfCards",view:"datatable",hidden:!0,columns:[{id:"index",header:"",sort:"int",width:35},{id:"id",header:"id",width:60},{id:"name",header:"Nazwa karty",fillspace:!0}],scheme:{$init:function(a){a.index=this.count()}}};let theOrderDetail={id:"theOrderDetail",view:"template",css:"theOrderDetail",gravity:1},privateOrdersUrlHandler=function(){let a="webixPrivateOrders/getTheOrders/"+conf.theUserId+".json";return webix.ajax(a).then(function(a){if(0<=a.text().search("records")){let b=a.json();return conf.thePeopleFilterHeader.options=b.peopleHavingPrivs,b.records}return[]})},listOfPrivateOrders={id:"listOfPrivateOrders",view:"datatable",select:!0,gravity:1.7,columns:kolumny,scheme:{$init:function(a){a.index=this.count()}},url:privateOrdersUrlHandler,on:{onBeforeFilter:onBeforeFilterHandler,onAfterLoad:onAfterLoadHandler,onAfterSelect:onAfterSelectHandler}},managePrivateOrders={id:"managePrivateOrders",padding:globalAppData.config.wyglad.mainPad,type:"space",css:"moj-naglowek",cols:[listOfPrivateOrders,{gravity:.01},{rows:[theOrderDetail,listOfCards]}]},manageCustomers={id:"manageCustomers",padding:globalAppData.config.wyglad.mainPad,type:"space",cols:[listOfCustomers,customerPanel]},toolbarMenu={id:"toolbarMenu",view:"menu",data:[{id:"klienci",value:"Klienci",icon:"address-book-o",whereToGo:manageCustomers.id},{id:"prywatne",value:"Prywatne",icon:"handshake-o",whereToGo:"managePrivateOrders"}],css:"toolbar-menu",ready:function(){$$(toolbarMenu.id).disableItem("klienci")},on:{onMenuItemClick:function(a){$$(this.getMenuItem(a).whereToGo).show(),$$(toolbarMenu.id).config.data.forEach(function(a){$$(toolbarMenu.id).enableItem(a.id)}),$$(toolbarMenu.id).disableItem(a)}}},userInfo={view:"button",type:"icon",icon:"user",label:globalAppData.loggedInUser.name,width:110,id:"userInfoToolbar",css:"kwa-mia-hau",click:function(){window.open(globalAppData.config.logoutUrl,"_self")}},mainToolbar={responsive:!0,view:"toolbar",padding:3,elements:[{view:"label",label:" ",width:68},{},userInfo]};let menu_data=[{id:"side-klienci",icon:"address-book-o",value:"Klienci",data:[{id:"side-klienci-list",value:"<i class=\"fa fa-list\" aria-hidden=\"true\"></i> Lista"},{id:"side-klienci-add",value:"<i class=\"fa fa-plus\" aria-hidden=\"true\"></i> Dodaj"}]},{id:"side-karty",icon:"credit-card",value:"Karty",data:[{id:"side-karty-list",value:"<i class=\"fa fa-list\" aria-hidden=\"true\"></i> Lista"},{id:"side-karty-add",value:"<i class=\"fa fa-plus\" aria-hidden=\"true\"></i> Dodaj"}]},{id:"side-handlowe",icon:"handshake-o",value:"Handlowe",data:[{id:"side-handlowe-list",value:"<i class=\"fa fa-list\" aria-hidden=\"true\"></i> Lista"},{id:"side-handlowe-add",value:"<i class=\"fa fa-plus\" aria-hidden=\"true\"></i> Dodaj"}]},{id:"side-produkcyjne",icon:"industry",value:"Produkcyjne",data:[{id:"side-produkcyjne-list",value:"<i class=\"fa fa-list\" aria-hidden=\"true\"></i> Lista"},{id:"side-produkcyjne-add",value:"<i class=\"fa fa-plus\" aria-hidden=\"true\"></i> Dodaj"}]}],leftSidebar={view:"sidebar",id:"lewy-sidebar",data:menu_data,collapsed:!0,on:{onAfterSelect:function(a){let b,c=!0;"side-klienci-list"===a?b="customers":"side-klienci-add"===a?b="customers/add":"side-karty-list"===a?b="cards":"side-karty-add"===a?b="cards/add":"side-handlowe-list"===a?b="orders":"side-handlowe-add"===a?b="orders/add":"side-produkcyjne-list"===a?b="jobs":"side-produkcyjne-add"===a?b="jobs/add":c=!1;c&&window.open(b,"_self")}}};let animacja={a:{direction:"top"},b:{type:"flip"},c:{type:"flip",subtype:"vertical"},d:{subtype:"out"},e:{subtype:"in"},f:!1},content={id:"content",animate:animacja.d,cells:[manageCustomers,managePrivateOrders]};webix.ready(function(){webix.ui({id:"theLayout",css:"app-main",rows:[mainToolbar,{cols:[leftSidebar,content]}]})});